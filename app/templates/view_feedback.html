<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Feedback Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .rating-stars {
      font-size: 1.2rem;
    }
    .progress {
      height: 10px;
    }
    .feedback-item {
      transition: all 0.3s ease;
    }
    .feedback-item:hover {
      background-color: #f8f9fa;
    }
    .star-filled {
      color: #ffc107;
    }
    .star-empty {
      color: #e4e5e9;
    }
  </style>
</head>
<body class="bg-light">

<div class="container mt-5">
  <div class="card shadow p-4">
    <h2 class="mb-4 text-center text-primary">Feedback & Rating Overview</h2>
    <!-- Statistics Section -->
    <div class="row mb-5">
      <!-- Left Column: Overall Rating -->
      <div class="col-md-4 mb-4">
        <div class="card border-0 shadow-sm p-3 h-100">
          <h5 class="text-center mb-3">Điểm xếp hạng & bài đánh giá</h5>

          <div class="text-center mb-4">
            <h1 class="text-warning fw-bold mb-1">{{ average_rating }}</h1>
            <div class="rating-stars mb-2">
              {% for i in range(5) %}
                {% if i < average_rating %}
                  <span class="star-filled">★</span>
                {% else %}
                  <span class="star-empty">☆</span>
                {% endif %}
              {% endfor %}
            </div>
            <p class="text-muted">{{ total_feedbacks }} lượt đánh giá</p>
          </div>

          <!-- Rating Distribution -->
          <div class="mt-3">
            {% for stars in [5,4,3,2,1] %}
            <div class="d-flex align-items-center mb-2">
              <span class="me-2" style="width: 25px;">{{ stars }}★</span>
              <div class="progress flex-grow-1 mx-2">
                <div class="progress-bar bg-warning" style="width: {{ rating_distribution[stars] }}%"></div>
              </div>
              <span style="width: 40px;">{{ rating_distribution[stars] }}%</span>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>

      <!-- Right Column: Feedback History -->
      <div class="col-md-8">
        <div class="card border-0 shadow-sm p-3 h-100">
          <h5 class="mb-3">Lịch sử đánh giá</h5>
          
          <div class="feedback-list" style="max-height: 400px; overflow-y: auto;">
            {% if feedbacks %}
              {% for feedback in feedbacks %}
              <div class="feedback-item border-bottom pb-3 mb-3">
                <div class="d-flex justify-content-between align-items-start">
                  <h6 class="mb-1 fw-bold">{{ feedback.user.username }}</h6>
                  <small class="text-muted">{{ feedback.created_at.strftime('%d/%m/%Y') if feedback.created_at else 'N/A' }}</small>
                </div>
                <div class="d-flex align-items-center mb-2">
                  <div class="rating-stars me-2">
                    {% for i in range(5) %}
                      {% if i < feedback.rating %}
                        <span class="star-filled">★</span>
                      {% else %}
                        <span class="star-empty">☆</span>
                      {% endif %}
                    {% endfor %}
                  </div>
                  <span class="text-muted">({{ feedback.rating }})</span>
                </div>
                <p class="mb-0">{{ feedback.content or "Không có nội dung" }}</p>
              </div>
              {% endfor %}
            {% else %}
              <div class="text-center text-muted py-4">
                <p>Chưa có feedback nào.</p>
              </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="d-flex justify-content-center gap-3 mt-4">
      <button class="btn btn-outline-secondary px-4" onclick="window.history.back()">Quay lại</button>
      <a href="/home" class="btn btn-primary px-4">Trang chủ</a>
    </div>

  </div>
</div>

<script>
  // Reset filter button (nếu có)
  const resetBtn = document.getElementById('resetBtn');
  if (resetBtn) {
    resetBtn.addEventListener('click', function() {
      const form = document.querySelector('form');
      form.reset();
    });
  }

  // Simple animation for progress bars
  document.addEventListener('DOMContentLoaded', function() {
    const progressBars = document.querySelectorAll('.progress-bar');
    progressBars.forEach(bar => {
      const width = bar.style.width;
      bar.style.width = '0';
      setTimeout(() => {
        bar.style.width = width;
      }, 300);
    });
  });
</script>

</body>
</html>